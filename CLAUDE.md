# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## é‡è¦ãªé–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

Claude Codeã¯ä»¥ä¸‹ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å¸¸ã«éµå®ˆã—ã¦ãã ã•ã„ï¼š

### 1. ã‚¿ã‚¹ã‚¯ç®¡ç†ã¨æ•´ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å‘½ä»¤ã‚’å—ã‘ãŸã‚‰ã€ã¾ãšTodoWriteãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã€æ•´ç†ã™ã‚‹
- è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã¯å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†è§£ã—ã¦ç®¡ç†ã™ã‚‹
- å„ã‚¿ã‚¹ã‚¯ã®é€²æ—çŠ¶æ³ã‚’æ˜ç¢ºã«è¨˜éŒ²ã™ã‚‹

### 2. ãƒ†ã‚¹ãƒˆå®Ÿæ–½
- å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã¯å¿…ãšãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹
- `npm run build` ã§ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª
- `npm run typecheck` ã§å‹ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª
- `npm run lint` ã§ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ãƒã‚§ãƒƒã‚¯
- é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§å®Ÿéš›ã®å‹•ä½œã‚’ç¢ºèª

### 3. ã‚¨ãƒ©ãƒ¼å¯¾å¿œ
- ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰ã€å³åº§ã«åŸå› ã‚’ç‰¹å®šã—ã¦ä¿®æ­£
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è©³ç´°ã«åˆ†æ
- ä¿®æ­£å¾Œã¯å†åº¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¦ã€ã‚¨ãƒ©ãƒ¼ãŒå®Œå…¨ã«è§£æ¶ˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª

### 4. è©•ä¾¡ã¨æ”¹å–„
- å®Ÿè£…çµæœã‚’è©•ä¾¡ï¼š
  - âœ… å®Œå…¨ã«å‹•ä½œã—ã€è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹
  - âŒ å‹•ä½œã—ãªã„ã€ã¾ãŸã¯è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ãªã„
- âŒã®å ´åˆã¯ã€å•é¡Œã‚’ä¿®æ­£ã—ã¦âœ…ã«ãªã‚‹ã¾ã§æ”¹å–„ã‚’ç¶šã‘ã‚‹
- å„ã‚¿ã‚¹ã‚¯ã®å®Œäº†æ™‚ã«æˆåŠŸ/å¤±æ•—ã‚’æ˜ç¢ºã«å ±å‘Š

### 5. é–‹ç™ºè¨˜éŒ²
- ã™ã¹ã¦ã®é‡è¦ãªå¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¨˜éŒ²
- DEVELOPMENT_LOG.mdã«é‡è¦ãªæ±ºå®šäº‹é …ã‚„å®Ÿè£…å†…å®¹ã‚’è¨˜éŒ²
- ã‚¨ãƒ©ãƒ¼ã¨ãã®è§£æ±ºæ–¹æ³•ã‚’æ–‡æ›¸åŒ–

### 6. ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®æ•´ç†
- ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ï¼š
  - æœªä½¿ç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  - ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰
  - ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
  - é‡è¤‡ã—ãŸã‚³ãƒ¼ãƒ‰
- ãŸã ã—ã€ä»¥ä¸‹ã¯å‰Šé™¤ã—ãªã„ï¼š
  - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
  - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
  - ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### 7. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãŒå¿…è¦ãªå ´åˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ¤æ–­ã‚„è¿½åŠ æƒ…å ±ãŒå¿…è¦ãªå ´åˆã¯ã€æ˜ç¢ºã«é€šçŸ¥
- ğŸ”” **ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒå¿…è¦ã§ã™ã€** ã¨æ˜ç¤º
- å…·ä½“çš„ã«ä½•ãŒå¿…è¦ã‹ã‚’èª¬æ˜
- é¸æŠè‚¢ãŒã‚ã‚‹å ´åˆã¯ã€ã™ã¹ã¦ã®é¸æŠè‚¢ã‚’æç¤º

## Project Overview
G-House Presentation System - A sales support application for housing presentations with A3 format print-optimized slides, HVAC/solar PV calculations, and Supabase database integration.

## Commands

### Development
```bash
npm run dev              # Start development server (default port 3000)
npm run dev:turbo        # Start with Turbopack for faster HMR
PORT=3010 npm run dev    # Run on specific port
```

### Build & Production
```bash
npm run build            # Production build
npm run build:turbo      # Production build with Turbopack
npm run build:dry        # Build without linting (faster for testing)
npm run start            # Start production server
```

### Code Quality
```bash
npm run lint             # Run ESLint
npm run typecheck        # Run TypeScript type checking (tsc --noEmit)
```

### Testing Commands
```bash
# ãƒ“ãƒ«ãƒ‰ã¨ã‚³ãƒ¼ãƒ‰å“è³ªã®å®Œå…¨ãƒã‚§ãƒƒã‚¯
npm run lint && npm run typecheck && npm run build

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§ã®å‹•ä½œç¢ºèª
npm run dev
# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã‚’é–‹ã„ã¦ç¢ºèª
```

## Architecture Overview

### Core Stack
- **Next.js 14.2.18** with App Router
- **TypeScript** with strict mode
- **Tailwind CSS 4** with dark mode support
- **Zustand** for state management
- **Supabase** for database operations

### Key Directories
- `app/` - Next.js app router pages
  - `cases/` - Customer case management with HVAC/PV simulations
  - `education/` - Training and role-play evaluation features
  - `print/` - A3 print-optimized layouts
  - `api/` - PDF export and search endpoints
- `components/` - Reusable components with A3-specific utilities
- `lib/` - Core business logic
  - `hvac.ts` - HVAC capacity calculations
  - `pv.ts` - Solar PV simulations and ROI calculations
  - `sheets.ts` - Supabase data operations
  - `supabase.ts` - Database client configuration

### A3 Print System
The entire application is optimized for A3 landscape format (420mm Ã— 297mm / 1190px Ã— 842px):
- Use `<A3Container>` component for print layouts
- `<A3AutoScaler>` handles responsive scaling
- Print-specific CSS in `styles/print.css`
- PDF export via `api/export-pdf` using html2canvas + jsPDF

### Database Schema (Supabase)
Key tables:
- `customers` - Customer profiles with building specifications
- `sales_scripts` - Section-based sales scripts
- `performance_actuals` - Historical performance data
- `pv_configs` - Solar panel configurations
- `role_play_evaluations` - Training evaluation records

### Environment Variables
Required in `.env.local`:
```
NEXT_PUBLIC_SUPABASE_URL=<your_supabase_url>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<your_supabase_anon_key>
```

### Git Workflow
- Pre-commit hooks run Prettier and ESLint via Husky
- Changes are automatically formatted and linted before commit
- Remote repository: https://github.com/Ghouse-development/alice
- Always test before committing: `npm run lint && npm run typecheck`

## Development Notes

### HVAC Calculations
The `lib/hvac.ts` module calculates heating/cooling capacity based on:
- UA value (thermal transmittance)
- C value (air tightness)
- Climate region (1-8 Japan regions)
- Floor area and ventilation rates

### Solar PV Simulations
The `lib/pv.ts` module provides:
- Panel layout calculations based on roof area
- 15-year NPV and ROI calculations
- Self-consumption vs grid feed-in modeling
- Multiple manufacturer configurations

### State Management
Zustand store (`lib/store.ts`) manages:
- Dashboard configuration
- Project data persistence
- Print settings
- User preferences

### Known Considerations
- Build may require increased memory allocation (4GB recommended)
- PDF export API route has 60-second timeout
- Turbopack can be used for faster development builds
- Node.js 20.x required (specified in package.json engines)

## Development Checklist
å®Ÿè£…æ™‚ã¯ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ï¼š
- [ ] ã‚¿ã‚¹ã‚¯ã‚’TodoWriteã§ç®¡ç†
- [ ] ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…
- [ ] `npm run lint` ã§ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯
- [ ] `npm run typecheck` ã§å‹ãƒã‚§ãƒƒã‚¯
- [ ] `npm run build` ã§ãƒ“ãƒ«ãƒ‰ç¢ºèª
- [ ] é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§å‹•ä½œç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°ä¿®æ­£
- [ ] çµæœã‚’è©•ä¾¡ï¼ˆâœ…/âŒï¼‰
- [ ] ã‚³ãƒŸãƒƒãƒˆã—ã¦è¨˜éŒ²